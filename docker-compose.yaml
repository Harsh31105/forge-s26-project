# Docker Compose configuration for multi-tier application
# Defines frontend, backend API, and PostgreSQL database services
services:
  # Frontend web application service
  frontend:
    # Build from local Dockerfile in frontend directory
    build:
      context: ./frontend
      dockerfile: ../images/frontend/Dockerfile
    # Wait for backend to be ready before starting
    depends_on:
      - backend
    # Map container port 3000 to host port 3000
    ports:
      - "3000:3000"
    # Connect to shared application network
    networks:
      - app-network

  # Backend API service
  backend:
    # Build from local Dockerfile in backend directory
    build:
      context: ./backend
      dockerfile: ../images/backend/Dockerfile
    # Environment variables for database connection
    # environment:
    #   # PostgreSQL connection string
    #   - DATABASE_URL=postgresql://user:password@db:5432/mydb
    # Map container port 8080 to host port 8080
    ports:
      - "8080:8080"
    # Wait for database to be ready before starting
    # depends_on:
    #   - db
    # Connect to shared application network
    networks:
      - app-network
  # PostgreSQL database service
  db:
    # Use official PostgreSQL 15 image
    image: postgres:15
    # Persist database data using named volume
    volumes:
      - db-data:/var/lib/postgresql/data
    # PostgreSQL configuration
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=mydb
    # Connect to shared application network
    networks:
      - app-network

# Named volume for persistent database storage
volumes:
  db-data:

# Network definition for inter-service communication
networks:
  app-network:
    driver: bridge
